# Cooking-Site-
Ð¡Ð¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¹ ÑÐ°Ð¹Ñ‚ Ñ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð°Ð¼Ð¸ Ð½Ð° PHP 8.2 + Nginx + PostgreSQL. ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð°Ð¼ (ILIKE), ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸, Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸, Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹. Ð“Ð¾Ñ‚Ð¾Ð² Ðº Ð´ÐµÐ¿Ð»Ð¾ÑŽ Ñ‡ÐµÑ€ÐµÐ· Docker Compose; init-ÑÐºÑ€Ð¸Ð¿Ñ‚Ñ‹ Ð‘Ð” Ð² /db, Ð¿Ñ€Ð¾Ð´-ÐºÐ¾Ð½Ñ„Ð¸Ð³ Ð´Ð»Ñ Traefik/HTTPS.

Ðž Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ

Ð¡Ð°Ð¹Ñ‚ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð¾Ð² Ð½Ð° PHP 8.2 + Nginx + PostgreSQL. ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð¸ÑÐº (ILIKE), ÐºÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸, Ð¼Ð¾Ð´Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐ¸ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð°, Ð°Ð´Ð°Ð¿Ñ‚Ð¸Ð²Ð½Ñ‹Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÑƒ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹. Ð¡Ð¾Ð±Ñ€Ð°Ð½ Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð² Docker, Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ Ð‘Ð”.

Ð’Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾ Ð½Ð°Ð·Ð²Ð°Ð½Ð¸ÑŽ/Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÑŽ/Ð¸Ð½Ð³Ñ€ÐµÐ´Ð¸ÐµÐ½Ñ‚Ð°Ð¼ (ILIKE, Ñ‚Ð¾ÐºÐµÐ½Ð¸Ð·Ð°Ñ†Ð¸Ñ).

ÐšÐ°Ñ‚ÐµÐ³Ð¾Ñ€Ð¸Ð¸ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð¾Ð², ÑÐ¾Ñ€Ñ‚Ð¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ð¾ Ð´Ð°Ñ‚Ðµ.

ÐœÐ¾Ð´Ð°Ð»ÐºÐ° Ñ Ð´ÐµÑ‚Ð°Ð»ÑÐ¼Ð¸ Ñ€ÐµÑ†ÐµÐ¿Ñ‚Ð° Ð¸ ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ð¸Ð½Ð³Ñ€ÐµÐ´Ð¸ÐµÐ½Ñ‚Ð¾Ð² (Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° recipe_ingredients).

Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ð¹ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€.

Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾Ðµ ÑÐºÑ€Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ HTML (safe()), PDO Ñ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ð¼Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ð¼Ð¸.

Ð“Ð¾Ñ‚Ð¾Ð²Ñ‹Ðµ Docker-ÑÐµÑ€Ð²Ð¸ÑÑ‹: db, php, web (+ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ adminer).

Ð¢ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ ÑÑ‚ÐµÐº

PHP-FPM 8.2 (Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ: pdo_pgsql, pgsql, mbstring, curl, opcache)

Nginx (root: /var/www/html/public)

PostgreSQL 17 (Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¸Ð· ./db/schema.sql)

Docker Compose

Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
project/
â”œâ”€ db/                        # SQL-Ð¸Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð‘Ð” (Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ ÑÑ‚Ð°Ñ€Ñ‚Ðµ Ñ‚Ð¾Ð¼Ð°)
â”‚  â””â”€ schema.sql
â”œâ”€ docker/
â”‚  â”œâ”€ nginx/
â”‚  â”‚  â””â”€ default.conf         # ÐºÐ¾Ð½Ñ„Ð¸Ð³ nginx (root -> /public)
â”‚  â””â”€ php/
â”‚     â”œâ”€ Dockerfile
â”‚     â””â”€ php.ini
â”œâ”€ partials/                  # Ñ…ÐµÐ´ÐµÑ€/Ñ„ÑƒÑ‚ÐµÑ€
â”œâ”€ public/                    # ÐºÐ¾Ñ€Ð½ÐµÐ²Ð°Ñ Ð¿Ð°Ð¿ÐºÐ° ÑÐ°Ð¹Ñ‚Ð° (Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð° Ð¸Ð· Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°)
â”‚  â”œâ”€ index.php
â”‚  â”œâ”€ get_recipe.php
â”‚  â”œâ”€ style.css, script.js
â”‚  â””â”€ images/                 # ÑÑŽÐ´Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼Ñ‹Ðµ Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ
â”œâ”€ config.php                 # Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð‘Ð”, Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸, ÑƒÑ‚Ð¸Ð»Ð¸Ñ‚Ñ‹
â”œâ”€ .env                       # Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (Ð½Ðµ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¸Ñ‚ÑŒ!)
â””â”€ docker-compose.yml

Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚ (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾)
1) ÐŸÑ€ÐµÐ´ÑƒÑÐ»Ð¾Ð²Ð¸Ñ

Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ Docker Ð¸ Docker Compose.

Ð¡Ð²Ð¾Ð±Ð¾Ð´ÐµÐ½ Ð¿Ð¾Ñ€Ñ‚ 80 (Ð¸Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½Ð¸Ñ‚Ðµ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸ÑŽ Ð¿Ð¾Ñ€Ñ‚Ð° Ð² compose).

2) ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ .env
APP_ENV=prod
DB_NAME=cooking_site
DB_USER=
DB_PASS=

3) Ð—Ð°Ð¿ÑƒÑÐº
docker compose up -d --build


Ð¡Ð°Ð¹Ñ‚: http://localhost

(Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾) ÐÐ´Ð¼Ð¸Ð½ÐµÑ€: http://localhost:8081

Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð‘Ð” (db/schema.sql) Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÑÑ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€Ð²Ð¾Ð¼ ÑÑ‚Ð°Ñ€Ñ‚Ðµ Ð¿ÑƒÑÑ‚Ð¾Ð³Ð¾ Ñ‚Ð¾Ð¼Ð° db_data.

4) ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ PHP â†’ Postgres (Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾)
docker compose exec php php -r '$pdo=new PDO(getenv("DB_DSN"),getenv("DB_USER"),getenv("DB_PASS")); echo "OK ".$pdo->query("select now()")->fetchColumn();'

5) ÐŸÐ¾Ð»ÐµÐ·Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹
docker compose ps
docker compose logs -f web
docker compose logs -f php
docker compose logs -f db
docker compose exec web nginx -t && docker compose exec web nginx -s reload
docker compose down -v   # ÑÑ‚Ð¾Ð¿ Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð¼Ð¾Ð² (ÑÐ¾Ñ‚Ñ€Ñ‘Ñ‚ Ð‘Ð”!)

ÐšÐ»ÑŽÑ‡ÐµÐ²Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
Nginx (docker/nginx/default.conf)

root: /var/www/html/public

ÐšÑ€Ð°ÑÐ¸Ð²Ñ‹Ðµ URL:

location / { try_files $uri $uri/ /index.php?$query_string; }


ÐŸÑ€Ð¾ÐºÑÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ PHP:

location ~ \.php$ {
  include fastcgi_params;
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  fastcgi_pass php:9000;
}


Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸: Ð·Ð°Ð¿Ñ€ÐµÑ‚ ÑÐºÑ€Ñ‹Ñ‚Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð², ÐºÑÑˆ ÑÑ‚Ð°Ñ‚Ð¸ÐºÐ¸, try_files $fastcgi_script_name =404;.

PHP (docker/php/Dockerfile)

Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ ÑÑ‚Ð°Ð²ÑÑ‚ÑÑ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ:

RUN apt-get update && apt-get install -y --no-install-recommends \
      libpq-dev git unzip libcurl4-openssl-dev \
  && docker-php-ext-install pdo_pgsql pgsql mbstring curl \
  && docker-php-ext-enable opcache \
  && rm -rf /var/lib/apt/lists/*

config.php

Ð§Ð¸Ñ‚Ð°ÐµÑ‚ DSN/ÐºÑ€ÐµÐ´Ñ‹ Ð¸Ð· ENV (Ð¸Ð»Ð¸ ÑÐ¾Ð±Ð¸Ñ€Ð°ÐµÑ‚ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ).

UPLOAD_DIR ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ð½Ð° __DIR__ . '/public/images/' â€” Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ñ„Ð°Ð¹Ð»Ñ‹ Ð±Ñ‹Ð»Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹ Ð¿Ð¾ Ð²ÐµÐ±Ñƒ.

Ð¥ÑƒÐºÐ¸ (Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ)

Healthcheck Ð‘Ð” â€” Ð² docker-compose.yml (pg_isready), ÑÐµÑ€Ð²Ð¸Ñ php Ð¶Ð´Ñ‘Ñ‚ service_healthy.

Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð‘Ð” â€” Ð¿Ð°Ð¿ÐºÐ° db/ Ð¼Ð¾Ð½Ñ‚Ð¸Ñ€ÑƒÐµÑ‚ÑÑ Ð² /docker-entrypoint-initdb.d (Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚ÑÑ Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð°).

ÐžÐ¿ÐºÐµÑˆ PHP â€” Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½ Ð² php.ini (ÑƒÑÐºÐ¾Ñ€ÐµÐ½Ð¸Ðµ FPM).

Ð¡Ñ‚Ð°Ñ‚Ð¸ÐºÐ° â€” ÐºÐ»Ð°Ð´Ð¸Ñ‚Ðµ CSS/JS/Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð² public/ Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð°Ð±ÑÐ¾Ð»ÑŽÑ‚Ð½Ñ‹Ðµ Ð¿ÑƒÑ‚Ð¸ (/style.css, /images/...).

ÐŸÑ€Ð¾Ð´Ð°ÐºÑˆÐ½ Ð´ÐµÐ¿Ð»Ð¾Ð¹ (VPS + Docker Compose + HTTPS)
Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 1: Ñ‡ÐµÑ€ÐµÐ· Traefik (Ð°Ð²Ñ‚Ð¾-HTTPS)

ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ DNS Ð´Ð»Ñ Ð´Ð¾Ð¼ÐµÐ½Ð° (A-Ð·Ð°Ð¿Ð¸ÑÑŒ Ð½Ð° IP VPS).

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ traefik Ð¸ Ð»ÐµÐ¹Ð±Ð»Ñ‹ Ðº web Ð² docker-compose.prod.yml (Ð²Ñ‹Ð½ÐµÑÐ¸Ñ‚Ðµ Ð¿Ð¾Ñ€Ñ‚Ñ‹ Ð½Ð°Ñ€ÑƒÐ¶Ñƒ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ñƒ Traefik).

Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ:

docker compose -f docker-compose.prod.yml up -d --build


Traefik Ð²Ñ‹Ð¿Ð¸ÑˆÐµÑ‚ ÑÐµÑ€Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ñ‹ Letâ€™s Encrypt Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸.

Ð’Ð°Ñ€Ð¸Ð°Ð½Ñ‚ 2: Render.com

Ð¡Ð¾Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÐµÐ´Ð¸Ð½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð· (Nginx + PHP-FPM Ñ‡ÐµÑ€ÐµÐ· supervisord), Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ DATABASE_URL.

Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ render.yaml (Blueprint) Ð´Ð»Ñ Ð²ÐµÐ±-ÑÐµÑ€Ð²Ð¸ÑÐ° Ð¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼Ð¾Ð³Ð¾ Postgres.

Ð’Ð°Ð¶Ð½Ð¾: Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ð´Ð»Ñ public/images â€” Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚Ðµ Persistent Disk Ð¸Ð»Ð¸ S3.

Ð¢Ð¾Ð½ÐºÐ¾ÑÑ‚Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²

Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ (compose) Ð¸Ð·Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑŽÑ‚ÑÑ Ð² bind-Ð¼Ð°ÑƒÐ½Ñ‚ â†’ Ð½Ðµ Ð¿Ñ€Ð¾Ð¿Ð°Ð´Ð°ÑŽÑ‚.
Ð’ Ð¾Ð±Ð»Ð°ÐºÐµ Ñ Ð±ÐµÑÑÐ¾ÑÑ‚Ð¾ÑÑ‡Ð½Ñ‹Ð¼Ð¸ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°Ð¼Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ Ð´Ð¸ÑÐº/Ð¾Ð±Ð»Ð°ÐºÐ¾ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, S3).

Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

CSS/JS Ð½Ðµ Ð³Ñ€ÑƒÐ·ÑÑ‚ÑÑ â€” Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð² public/ Ð¸Ð»Ð¸ Ð¾Ñ‚Ð½Ð¾ÑÐ¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð¿ÑƒÑ‚ÑŒ. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ /style.css, /script.js, /images/....

404 Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ðµ Ð¸Ð· Ð°Ð´Ð¼Ð¸Ð½ÐºÐ¸ â€” ÑÑÑ‹Ð»ÐºÐ° Ð½Ð° public/index.php. Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ / Ð¸Ð»Ð¸ /index.php.

ÐÐµÑ‚ ÐºÐ¾Ð½Ð½ÐµÐºÑ‚Ð° Ðº Ð‘Ð” â€” Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ DB_* Ð² php (docker compose exec php env | grep DB_), Ð»Ð¾Ð³Ð¸ db.

ÐŸÐ¾Ñ€Ñ‚ 80 Ð·Ð°Ð½ÑÑ‚ â€” Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾ Ð¼ÐµÐ½ÑÐ¹Ñ‚Ðµ Ð½Ð° "8080:80" Ð¸ Ð¾Ñ‚ÐºÑ€Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ http://localhost:8080.

Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ñ„Ð°Ð¹Ð» LICENSE Ð¿Ð¾ Ð²Ð°ÑˆÐµÐ¼Ñƒ Ð²Ñ‹Ð±Ð¾Ñ€Ñƒ (MIT/Apache-2.0/GPL-3.0 Ð¸ Ñ‚.Ð´.).

ðŸ‡¬ðŸ‡§ English Version
About

Recipe website powered by PHP 8.2, Nginx, and PostgreSQL. It features ILIKE-based search, categories, modal recipe view, responsive UI, and image uploads. Docker-first setup with automatic DB initialization.

Features

Full-textâ€“like search (ILIKE with tokenization) across title/description/ingredients.

Categories, newest-first ordering.

Modal recipe details with structured ingredients (recipe_ingredients).

Image uploads stored under public/images.

Secure output escaping (safe()), PDO prepared statements.

Ready-made Docker services: db, php, web (+ optional adminer).

Tech Stack

PHP-FPM 8.2 (pdo_pgsql, pgsql, mbstring, curl, opcache)

Nginx (root: /var/www/html/public)

PostgreSQL 17 (init from ./db/schema.sql)

Docker Compose

Project Structure
project/
â”œâ”€ db/                        # DB init (runs on first empty volume creation)
â”‚  â””â”€ schema.sql
â”œâ”€ docker/
â”‚  â”œâ”€ nginx/
â”‚  â”‚  â””â”€ default.conf
â”‚  â””â”€ php/
â”‚     â”œâ”€ Dockerfile
â”‚     â””â”€ php.ini
â”œâ”€ partials/
â”œâ”€ public/                    # web root
â”‚  â”œâ”€ index.php
â”‚  â”œâ”€ get_recipe.php
â”‚  â”œâ”€ style.css, script.js
â”‚  â””â”€ images/                 # uploaded media
â”œâ”€ config.php
â”œâ”€ .env
â””â”€ docker-compose.yml

Quick Start (local)
1) Prereqs

Docker and Docker Compose installed.

Port 80 available (or change the mapping).

2) .env
APP_ENV=prod
DB_NAME=cooking_site
DB_USER=Admin
DB_PASS=strong_password

3) Run
docker compose up -d --build


App: http://localhost

(optional) Adminer: http://localhost:8081

DB init (db/schema.sql) runs only once when the db_data volume is created.

4) Connectivity test (optional)
docker compose exec php php -r '$pdo=new PDO(getenv("DB_DSN"),getenv("DB_USER"),getenv("DB_PASS")); echo "OK ".$pdo->query("select now()")->fetchColumn();'

5) Useful commands
docker compose ps
docker compose logs -f web
docker compose logs -f php
docker compose logs -f db
docker compose exec web nginx -t && docker compose exec web nginx -s reload
docker compose down -v   # stop & remove volumes (wipes DB!)

Key Files & Settings
Nginx (docker/nginx/default.conf)

root: /var/www/html/public

Pretty URLs:

location / { try_files $uri $uri/ /index.php?$query_string; }


PHP proxy:

location ~ \.php$ {
  include fastcgi_params;
  fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
  fastcgi_pass php:9000;
}


Recommended: deny dotfiles, cache static assets, try_files $fastcgi_script_name =404;.

PHP (docker/php/Dockerfile)

Ensure extensions are installed:

RUN apt-get update && apt-get install -y --no-install-recommends \
      libpq-dev git unzip libcurl4-openssl-dev \
  && docker-php-ext-install pdo_pgsql pgsql mbstring curl \
  && docker-php-ext-enable opcache \
  && rm -rf /var/lib/apt/lists/*

config.php

Reads DSN/credentials from env (fallbacks included).

UPLOAD_DIR points to __DIR__ . '/public/images/' so files are web-served.

Hooks (operational)

DB healthcheck in docker-compose.yml (pg_isready), php waits for service_healthy.

DB init from db/ on first run of an empty volume.

PHP opcache enabled in php.ini.

Static assets go under public/; use absolute URLs (/style.css, /images/...).

Production Deploy (VPS + Docker Compose + HTTPS)
Option 1: Traefik (auto HTTPS)

Configure DNS (A-record to your VPS IP).

Add traefik service and labels to web in docker-compose.prod.yml (only Traefik exposes ports).

Run:

docker compose -f docker-compose.prod.yml up -d --build


Traefik will provision Letâ€™s Encrypt certs automatically.

Option 2: Render.com

Build a single container (Nginx + PHP-FPM via supervisord), use DATABASE_URL.

render.yaml (Blueprint) provisions a web service + managed Postgres.

Important: use a Persistent Disk or S3 for public/images.

File Uploads

Local (compose): uploads persist via bind mount.
Cloud: use persistent storage (disk/S3) â€” ephemeral containers lose local files on deploys.

Troubleshooting

CSS/JS not loading â€” file not in public/ or relative path. Use /style.css, /script.js, /images/....

404 from admin â€” link pointing to public/index.php. Use / or /index.php.

DB connect error â€” verify DB_* in the php container and check db logs.

Port 80 in use â€” map "8080:80" and open http://localhost:8080.

License

Add a LICENSE file of your choice (MIT/Apache-2.0/GPL-3.0, etc.).
